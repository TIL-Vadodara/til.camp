{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/messaging/package.json","includedInParent":true,"mtime":1519337717000},{"name":"tslib","loc":{"line":17,"column":25}},{"name":"./controller-interface","loc":{"line":18,"column":32}},{"name":"../models/errors","loc":{"line":19,"column":19}},{"name":"../models/worker-page-message","loc":{"line":20,"column":30}},{"name":"../models/default-sw","loc":{"line":21,"column":22}},{"name":"../models/notification-permission","loc":{"line":22,"column":36}},{"name":"../models/fcm-details","loc":{"line":23,"column":23}},{"name":"../helpers/base64-to-array-buffer","loc":{"line":24,"column":32}},{"name":"@firebase/util","loc":{"line":25,"column":32}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"tslib\"),t=E(e),r=require(\"./controller-interface\"),i=g(r),o=require(\"../models/errors\"),s=g(o),n=require(\"../models/worker-page-message\"),a=g(n),c=require(\"../models/default-sw\"),u=g(c),_=require(\"../models/notification-permission\"),f=g(_),d=require(\"../models/fcm-details\"),l=g(d),h=require(\"../helpers/base64-to-array-buffer\"),p=g(h),v=require(\"@firebase/util\");function g(e){return e&&e.__esModule?e:{default:e}}function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var y=function(e){function r(t){var r=e.call(this,t)||this;return r.messageObserver_=null,r.onMessage_=(0,v.createSubscribe)(function(e){r.messageObserver_=e}),r.tokenRefreshObserver_=null,r.onTokenRefresh_=(0,v.createSubscribe)(function(e){r.tokenRefreshObserver_=e}),r.registrationToUse_,r.manifestCheckPromise_,r.messageObserver_=null,r.onMessage_=(0,v.createSubscribe)(function(e){r.messageObserver_=e}),r.tokenRefreshObserver_=null,r.onTokenRefresh_=(0,v.createSubscribe)(function(e){r.tokenRefreshObserver_=e}),r.setupSWMessageListener_(),r}return t.__extends(r,e),r.prototype.getToken=function(){var t=this;return this.isSupported_()?this.manifestCheck_().then(function(){return e.prototype.getToken.call(t)}):Promise.reject(this.errorFactory_.create(s.default.codes.UNSUPPORTED_BROWSER))},r.prototype.manifestCheck_=function(){var e=this;if(this.manifestCheckPromise_)return this.manifestCheckPromise_;var t=document.querySelector('link[rel=\"manifest\"]');return this.manifestCheckPromise_=t?fetch(t.href).then(function(e){return e.json()}).catch(function(){}).then(function(t){if(t&&t.gcm_sender_id&&\"103953800507\"!==t.gcm_sender_id)throw e.errorFactory_.create(s.default.codes.INCORRECT_GCM_SENDER_ID)}):Promise.resolve(),this.manifestCheckPromise_},r.prototype.requestPermission=function(){return t.__awaiter(this,void 0,void 0,function(){var e=this;return t.__generator(this,function(t){return Notification.permission===f.default.granted?[2]:[2,new Promise(function(t,r){var i=function(i){return i===f.default.granted?t():i===f.default.denied?r(e.errorFactory_.create(s.default.codes.PERMISSION_BLOCKED)):r(e.errorFactory_.create(s.default.codes.PERMISSION_DEFAULT))},o=Notification.requestPermission(i);o&&o.then(i)})]})})},r.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw this.errorFactory_.create(s.default.codes.SW_REGISTRATION_EXPECTED);if(void 0!==this.registrationToUse_)throw this.errorFactory_.create(s.default.codes.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse_=e},r.prototype.usePublicVapidKey=function(e){if(\"string\"!=typeof e)throw this.errorFactory_.create(s.default.codes.INVALID_PUBLIC_VAPID_KEY);if(void 0!==this.publicVapidKeyToUse_)throw this.errorFactory_.create(s.default.codes.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var t=(0,p.default)(e);if(65!==t.length)throw this.errorFactory_.create(s.default.codes.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse_=t},r.prototype.onMessage=function(e,t,r){return this.onMessage_(e,t,r)},r.prototype.onTokenRefresh=function(e,t,r){return this.onTokenRefresh_(e,t,r)},r.prototype.waitForRegistrationToActivate_=function(e){var t=this,r=e.installing||e.waiting||e.active;return new Promise(function(i,o){if(r)if(\"activated\"!==r.state)if(\"redundant\"!==r.state){var n=function(){if(\"activated\"===r.state)i(e);else{if(\"redundant\"!==r.state)return;o(t.errorFactory_.create(s.default.codes.SW_REG_REDUNDANT))}r.removeEventListener(\"statechange\",n)};r.addEventListener(\"statechange\",n)}else o(t.errorFactory_.create(s.default.codes.SW_REG_REDUNDANT));else i(e);else o(t.errorFactory_.create(s.default.codes.NO_SW_IN_REG))})},r.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse_?this.waitForRegistrationToActivate_(this.registrationToUse_):(this.registrationToUse_=null,navigator.serviceWorker.register(u.default.path,{scope:u.default.scope}).catch(function(t){throw e.errorFactory_.create(s.default.codes.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return e.registrationToUse_=t,t.update(),t})}))},r.prototype.getPublicVapidKey_=function(){return this.publicVapidKeyToUse_?Promise.resolve(this.publicVapidKeyToUse_):Promise.resolve(l.default.DEFAULT_PUBLIC_VAPID_KEY)},r.prototype.getPushSubscription_=function(e,t){return e.pushManager.getSubscription().then(function(r){return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})})},r.prototype.setupSWMessageListener_=function(){var e=this;\"serviceWorker\"in navigator&&navigator.serviceWorker.addEventListener(\"message\",function(t){if(t.data&&t.data[a.default.PARAMS.TYPE_OF_MSG]){var r=t.data;switch(r[a.default.PARAMS.TYPE_OF_MSG]){case a.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED:case a.default.TYPES_OF_MSG.NOTIFICATION_CLICKED:var i=r[a.default.PARAMS.DATA];e.messageObserver_&&e.messageObserver_.next(i)}}},!1)},r.prototype.isSupported_=function(){return\"serviceWorker\"in navigator&&\"PushManager\"in window&&\"Notification\"in window&&\"fetch\"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty(\"showNotification\")&&PushSubscription.prototype.hasOwnProperty(\"getKey\")},r}(i.default);exports.default=y;"},"hash":"200e2dfd3c05be64a4e989fa4e30880e","cacheData":{"env":{}}}