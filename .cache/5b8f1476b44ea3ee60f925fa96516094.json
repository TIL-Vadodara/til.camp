{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/database/package.json","includedInParent":true,"mtime":1519337717000},{"name":"@firebase/util","loc":{"line":19,"column":21}},{"name":"./util/Path","loc":{"line":20,"column":21}},{"name":"./CompoundWrite","loc":{"line":21,"column":30}},{"name":"./snap/indexes/PriorityIndex","loc":{"line":22,"column":30}},{"name":"./snap/ChildrenNode","loc":{"line":23,"column":29}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"@firebase/util\"),t=require(\"@firebase/util\"),i=require(\"./util/Path\"),r=require(\"./CompoundWrite\"),n=require(\"./snap/indexes/PriorityIndex\"),l=require(\"./snap/ChildrenNode\"),s=function(){function s(){this.visibleWrites_=r.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1}return s.prototype.childWrites=function(e){return new o(e,this)},s.prototype.addOverwrite=function(e,i,r,n){t.assert(r>this.lastWriteId_,\"Stacking an older write on top of newer ones\"),void 0===n&&(n=!0),this.allWrites_.push({path:e,snap:i,writeId:r,visible:n}),n&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,i)),this.lastWriteId_=r},s.prototype.addMerge=function(e,i,r){t.assert(r>this.lastWriteId_,\"Stacking an older merge on top of newer ones\"),this.allWrites_.push({path:e,children:i,writeId:r,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,i),this.lastWriteId_=r},s.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var i=this.allWrites_[t];if(i.writeId===e)return i}return null},s.prototype.removeWrite=function(i){var r=this,n=this.allWrites_.findIndex(function(e){return e.writeId===i});t.assert(n>=0,\"removeWrite called with nonexistent writeId.\");var l=this.allWrites_[n];this.allWrites_.splice(n,1);for(var s=l.visible,o=!1,a=this.allWrites_.length-1;s&&a>=0;){var h=this.allWrites_[a];h.visible&&(a>=n&&this.recordContainsPath_(h,l.path)?s=!1:l.path.contains(h.path)&&(o=!0)),a--}if(s){if(o)return this.resetTree_(),!0;if(l.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(l.path);else{var d=l.children;e.forEach(d,function(e){r.visibleWrites_=r.visibleWrites_.removeWrite(l.path.child(e))})}return!0}return!1},s.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},s.prototype.calcCompleteEventCache=function(e,t,r,n){if(r||n){var o=this.visibleWrites_.childCompoundWrite(e);if(!n&&o.isEmpty())return t;if(n||null!=t||o.hasCompleteWrite(i.Path.Empty)){var a=s.layerTree_(this.allWrites_,function(t){return(t.visible||n)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);p=t||l.ChildrenNode.EMPTY_NODE;return a.apply(p)}return null}var h=this.visibleWrites_.getCompleteNode(e);if(null!=h)return h;var d=this.visibleWrites_.childCompoundWrite(e);if(d.isEmpty())return t;if(null!=t||d.hasCompleteWrite(i.Path.Empty)){var p=t||l.ChildrenNode.EMPTY_NODE;return d.apply(p)}return null},s.prototype.calcCompleteEventChildren=function(e,t){var r=l.ChildrenNode.EMPTY_NODE,s=this.visibleWrites_.getCompleteNode(e);if(s)return s.isLeafNode()||s.forEachChild(n.PRIORITY_INDEX,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(t){var o=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(n.PRIORITY_INDEX,function(e,t){var n=o.childCompoundWrite(new i.Path(e)).apply(t);r=r.updateImmediateChild(e,n)}),o.getCompleteChildren().forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r},s.prototype.calcEventCacheAfterServerOverwrite=function(e,i,r,n){t.assert(r||n,\"Either existingEventSnap or existingServerSnap must exist\");var l=e.child(i);if(this.visibleWrites_.hasCompleteWrite(l))return null;var s=this.visibleWrites_.childCompoundWrite(l);return s.isEmpty()?n.getChild(i):s.apply(n.getChild(i))},s.prototype.calcCompleteChild=function(e,t,i){var r=e.child(t),n=this.visibleWrites_.getCompleteNode(r);return null!=n?n:i.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(i.getNode().getImmediateChild(t)):null},s.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},s.prototype.calcIndexedSlice=function(e,t,r,n,l,s){var o,a=this.visibleWrites_.childCompoundWrite(e),h=a.getCompleteNode(i.Path.Empty);if(null!=h)o=h;else{if(null==t)return[];o=a.apply(t)}if((o=o.withIndex(s)).isEmpty()||o.isLeafNode())return[];for(var d=[],p=s.getCompare(),c=l?o.getReverseIteratorFrom(r,s):o.getIteratorFrom(r,s),u=c.getNext();u&&d.length<n;)0!==p(u,r)&&d.push(u),u=c.getNext();return d},s.prototype.recordContainsPath_=function(t,i){return t.snap?t.path.contains(i):!!e.findKey(t.children,function(e,r){return t.path.child(r).contains(i)})},s.prototype.resetTree_=function(){this.visibleWrites_=s.layerTree_(this.allWrites_,s.DefaultFilter_,i.Path.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},s.DefaultFilter_=function(e){return e.visible},s.layerTree_=function(n,l,s){for(var o=r.CompoundWrite.Empty,a=0;a<n.length;++a){var h=n[a];if(l(h)){var d=h.path,p=void 0;if(h.snap)s.contains(d)?(p=i.Path.relativePath(s,d),o=o.addWrite(p,h.snap)):d.contains(s)&&(p=i.Path.relativePath(d,s),o=o.addWrite(i.Path.Empty,h.snap.getChild(p)));else{if(!h.children)throw t.assertionError(\"WriteRecord should have .snap or .children\");if(s.contains(d))p=i.Path.relativePath(s,d),o=o.addWrites(p,h.children);else if(d.contains(s))if((p=i.Path.relativePath(d,s)).isEmpty())o=o.addWrites(i.Path.Empty,h.children);else{var c=e.safeGet(h.children,p.getFront());if(c){var u=c.getChild(p.popFront());o=o.addWrite(i.Path.Empty,u)}}}}}return o},s}();exports.WriteTree=s;var o=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,i){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,i)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,i){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,i)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,i,r,n){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,i,r,n)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}();exports.WriteTreeRef=o;"},"hash":"4a6a5f5cb4183fd96954c1e765dfd85d","cacheData":{"env":{}}}