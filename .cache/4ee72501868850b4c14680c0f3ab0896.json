{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/storage/package.json","includedInParent":true,"mtime":1519337717000},{"name":"./implementation/taskenums","loc":{"line":29,"column":30}},{"name":"./implementation/observer","loc":{"line":20,"column":25}},{"name":"./tasksnapshot","loc":{"line":22,"column":35}},{"name":"./implementation/args","loc":{"line":23,"column":25}},{"name":"./implementation/array","loc":{"line":24,"column":26}},{"name":"./implementation/async","loc":{"line":25,"column":34}},{"name":"./implementation/error","loc":{"line":26,"column":24}},{"name":"./implementation/promise_external","loc":{"line":27,"column":32}},{"name":"./implementation/requests","loc":{"line":28,"column":29}},{"name":"./implementation/type","loc":{"line":30,"column":27}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.UploadTask=void 0;var t=require(\"./implementation/taskenums\"),e=k(t),a=require(\"./implementation/observer\"),r=require(\"./tasksnapshot\"),n=require(\"./implementation/args\"),s=k(n),i=require(\"./implementation/array\"),o=k(i),l=require(\"./implementation/async\"),u=require(\"./implementation/error\"),_=k(u),h=require(\"./implementation/promise_external\"),c=k(h),p=require(\"./implementation/requests\"),d=k(p),S=require(\"./implementation/type\"),f=k(S);function k(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}var v=function(){function n(e,a,r,n,s,i){void 0===i&&(i=null);var o=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.authWrapper_=a,this.location_=r,this.blob_=s,this.metadata_=i,this.mappings_=n,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=t.InternalTaskState.RUNNING,this.errorHandler_=function(e){o.request_=null,o.chunkMultiplier_=1,e.codeEquals(_.Code.CANCELED)?(o.needToFetchStatus_=!0,o.completeTransitions_()):(o.error_=e,o.transition_(t.InternalTaskState.ERROR))},this.metadataErrorHandler_=function(e){o.request_=null,e.codeEquals(_.Code.CANCELED)?o.completeTransitions_():(o.error_=e,o.transition_(t.InternalTaskState.ERROR))},this.promise_=c.make(function(t,e){o.resolve_=t,o.reject_=e,o.start_()}),this.promise_.then(null,function(){})}return n.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(a,r){t.updateProgress_(e+a)}},n.prototype.shouldDoResumable_=function(t){return t.size()>262144},n.prototype.start_=function(){this.state_===t.InternalTaskState.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},n.prototype.resolveToken_=function(e){var a=this;this.authWrapper_.getAuthToken().then(function(r){switch(a.state_){case t.InternalTaskState.RUNNING:e(r);break;case t.InternalTaskState.CANCELING:a.transition_(t.InternalTaskState.CANCELED);break;case t.InternalTaskState.PAUSING:a.transition_(t.InternalTaskState.PAUSED)}})},n.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var a=d.createResumableUpload(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(a,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},n.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(a){var r=d.getResumableUploadStatus(t.authWrapper_,t.location_,e,t.blob_),n=t.authWrapper_.makeRequest(r,a);t.request_=n,n.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},n.prototype.continueUpload_=function(){var e=this,a=d.resumableUploadChunkSize*this.chunkMultiplier_,r=new d.ResumableUploadStatus(this.transferred_,this.blob_.size()),n=this.uploadUrl_;this.resolveToken_(function(s){var i;try{i=d.continueResumableUpload(e.location_,e.authWrapper_,n,e.blob_,a,e.mappings_,r,e.makeProgressCallback_())}catch(a){return e.error_=a,void e.transition_(t.InternalTaskState.ERROR)}var o=e.authWrapper_.makeRequest(i,s);e.request_=o,o.getPromise().then(function(a){e.increaseMultiplier_(),e.request_=null,e.updateProgress_(a.current),a.finalized?(e.metadata_=a.metadata,e.transition_(t.InternalTaskState.SUCCESS)):e.completeTransitions_()},e.errorHandler_)})},n.prototype.increaseMultiplier_=function(){d.resumableUploadChunkSize*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},n.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_(function(a){var r=d.getMetadata(e.authWrapper_,e.location_,e.mappings_),n=e.authWrapper_.makeRequest(r,a);e.request_=n,n.getPromise().then(function(a){e.request_=null,e.metadata_=a,e.transition_(t.InternalTaskState.SUCCESS)},e.metadataErrorHandler_)})},n.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_(function(a){var r=d.multipartUpload(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),n=e.authWrapper_.makeRequest(r,a);e.request_=n,n.getPromise().then(function(a){e.request_=null,e.metadata_=a,e.updateProgress_(e.blob_.size()),e.transition_(t.InternalTaskState.SUCCESS)},e.errorHandler_)})},n.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},n.prototype.transition_=function(e){if(this.state_!==e)switch(e){case t.InternalTaskState.CANCELING:case t.InternalTaskState.PAUSING:this.state_=e,null!==this.request_&&this.request_.cancel();break;case t.InternalTaskState.RUNNING:var a=this.state_===t.InternalTaskState.PAUSED;this.state_=e,a&&(this.notifyObservers_(),this.start_());break;case t.InternalTaskState.PAUSED:this.state_=e,this.notifyObservers_();break;case t.InternalTaskState.CANCELED:this.error_=_.canceled(),this.state_=e,this.notifyObservers_();break;case t.InternalTaskState.ERROR:case t.InternalTaskState.SUCCESS:this.state_=e,this.notifyObservers_()}},n.prototype.completeTransitions_=function(){switch(this.state_){case t.InternalTaskState.PAUSING:this.transition_(t.InternalTaskState.PAUSED);break;case t.InternalTaskState.CANCELING:this.transition_(t.InternalTaskState.CANCELED);break;case t.InternalTaskState.RUNNING:this.start_()}},Object.defineProperty(n.prototype,\"snapshot\",{get:function(){var t=e.taskStateFromInternalTaskState(this.state_);return new r.UploadTaskSnapshot(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),n.prototype.on=function(e,r,n,i){void 0===r&&(r=void 0),void 0===n&&(n=void 0),void 0===i&&(i=void 0);var o=\"Expected a function or an Object with one of `next`, `error`, `complete` properties.\",l=s.nullFunctionSpec(!0).validator,u=s.looseObjectSpec(null,!0).validator;function _(t){try{return void l(t)}catch(t){}try{if(u(t),!(f.isJustDef(t.next)||f.isJustDef(t.error)||f.isJustDef(t.complete)))throw\"\";return}catch(t){throw o}}var h=[s.stringSpec(function(a){if(e!==t.TaskEvent.STATE_CHANGED)throw\"Expected one of the event types: [\"+t.TaskEvent.STATE_CHANGED+\"].\"}),s.looseObjectSpec(_,!0),s.nullFunctionSpec(!0),s.nullFunctionSpec(!0)];s.validate(\"on\",h,arguments);var c=this;function p(t){return function(e,r,n){null!==t&&s.validate(\"on\",t,arguments);var o=new a.Observer(e,r,i);return c.addObserver_(o),function(){c.removeObserver_(o)}}}var d=[s.looseObjectSpec(function(t){if(null===t)throw o;_(t)}),s.nullFunctionSpec(!0),s.nullFunctionSpec(!0)];return!(f.isJustDef(r)||f.isJustDef(n)||f.isJustDef(i))?p(d):p(null)(r,n,i)},n.prototype.then=function(t,e){return this.promise_.then(t,e)},n.prototype.catch=function(t){return this.then(null,t)},n.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},n.prototype.removeObserver_=function(t){o.remove(this.observers_,t)},n.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),o.clone(this.observers_).forEach(function(e){t.notifyObserver_(e)})},n.prototype.finishPromise_=function(){if(null!==this.resolve_){var a=!0;switch(e.taskStateFromInternalTaskState(this.state_)){case t.TaskState.SUCCESS:(0,l.async)(this.resolve_.bind(null,this.snapshot))();break;case t.TaskState.CANCELED:case t.TaskState.ERROR:var r=this.reject_;(0,l.async)(r.bind(null,this.error_))();break;default:a=!1}a&&(this.resolve_=null,this.reject_=null)}},n.prototype.notifyObserver_=function(a){switch(e.taskStateFromInternalTaskState(this.state_)){case t.TaskState.RUNNING:case t.TaskState.PAUSED:null!==a.next&&(0,l.async)(a.next.bind(a,this.snapshot))();break;case t.TaskState.SUCCESS:null!==a.complete&&(0,l.async)(a.complete.bind(a))();break;case t.TaskState.CANCELED:case t.TaskState.ERROR:null!==a.error&&(0,l.async)(a.error.bind(a,this.error_))();break;default:null!==a.error&&(0,l.async)(a.error.bind(a,this.error_))()}},n.prototype.resume=function(){s.validate(\"resume\",[],arguments);var e=this.state_===t.InternalTaskState.PAUSED||this.state_===t.InternalTaskState.PAUSING;return e&&this.transition_(t.InternalTaskState.RUNNING),e},n.prototype.pause=function(){s.validate(\"pause\",[],arguments);var e=this.state_===t.InternalTaskState.RUNNING;return e&&this.transition_(t.InternalTaskState.PAUSING),e},n.prototype.cancel=function(){s.validate(\"cancel\",[],arguments);var e=this.state_===t.InternalTaskState.RUNNING||this.state_===t.InternalTaskState.PAUSING;return e&&this.transition_(t.InternalTaskState.CANCELING),e},n}();exports.UploadTask=v;"},"hash":"f14850f231d2fe615c515da868bf29f7","cacheData":{"env":{}}}