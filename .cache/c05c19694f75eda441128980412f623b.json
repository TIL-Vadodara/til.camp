{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/database/package.json","includedInParent":true,"mtime":1519337717000},{"name":"@firebase/app","loc":{"line":18,"column":20}},{"name":"@firebase/util","loc":{"line":26,"column":21}},{"name":"../core/util/util","loc":{"line":20,"column":21}},{"name":"../core/stats/StatsManager","loc":{"line":21,"column":29}},{"name":"./Constants","loc":{"line":22,"column":26}},{"name":"../core/storage/storage","loc":{"line":24,"column":24}},{"name":"process"}],"generated":{"js":"var process = require(\"process\");\nvar e=require(\"process\");Object.defineProperty(exports,\"__esModule\",{value:!0});var t=require(\"@firebase/app\"),n=require(\"@firebase/util\"),o=require(\"../core/util/util\"),i=require(\"../core/stats/StatsManager\"),s=require(\"./Constants\"),r=require(\"@firebase/util\"),a=require(\"../core/storage/storage\"),l=require(\"@firebase/util\"),c=require(\"@firebase/util\"),h=16384,u=45e3,f=null;function p(e){f=e}\"undefined\"!=typeof MozWebSocket?f=MozWebSocket:\"undefined\"!=typeof WebSocket&&(f=WebSocket),exports.setWebSocketImpl=p;var d=function(){function p(e,t,n,s){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=o.logWrapper(this.connId),this.stats_=i.StatsManager.getCollection(t),this.connURL=p.connectionURL_(t,n,s)}return p.connectionURL_=function(e,t,n){var o={};return o[s.VERSION_PARAM]=s.PROTOCOL_VERSION,!c.isNodeSdk()&&\"undefined\"!=typeof location&&location.href&&-1!==location.href.indexOf(s.FORGE_DOMAIN)&&(o[s.REFERER_PARAM]=s.FORGE_REF),t&&(o[s.TRANSPORT_SESSION_PARAM]=t),n&&(o[s.LAST_SESSION_PARAM]=n),e.connectionURL(s.WEBSOCKET,o)},p.prototype.open=function(n,o){var i=this;this.onDisconnect=o,this.onMessage=n,this.log_(\"Websocket connecting to \"+this.connURL),this.everConnected_=!1,a.PersistentStorage.set(\"previous_websocket_failure\",!0);try{if(c.isNodeSdk()){var l=r.CONSTANTS.NODE_ADMIN?\"AdminNode\":\"Node\",h={headers:{\"User-Agent\":\"Firebase/\"+s.PROTOCOL_VERSION+\"/\"+t.default.SDK_VERSION+\"/\"+e.platform+\"/\"+l}},u=e.env,p=0==this.connURL.indexOf(\"wss://\")?u.HTTPS_PROXY||u.https_proxy:u.HTTP_PROXY||u.http_proxy;p&&(h.proxy={origin:p}),this.mySock=new f(this.connURL,[],h)}else this.mySock=new f(this.connURL)}catch(e){this.log_(\"Error instantiating WebSocket.\");var d=e.message||e.data;return d&&this.log_(d),void this.onClosed_()}this.mySock.onopen=function(){i.log_(\"Websocket connected.\"),i.everConnected_=!0},this.mySock.onclose=function(){i.log_(\"Websocket connection was disconnected.\"),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(e){i.handleIncomingFrame(e)},this.mySock.onerror=function(e){i.log_(\"WebSocket error.  Closing connection.\");var t=e.message||e.data;t&&i.log_(t),i.onClosed_()}},p.prototype.start=function(){},p.forceDisallow=function(){p.forceDisallow_=!0},p.isAvailable=function(){var e=!1;if(\"undefined\"!=typeof navigator&&navigator.userAgent){var t=navigator.userAgent.match(/Android ([0-9]{0,}\\.[0-9]{0,})/);t&&t.length>1&&parseFloat(t[1])<4.4&&(e=!0)}return!e&&null!==f&&!p.forceDisallow_},p.previouslyFailed=function(){return a.PersistentStorage.isInMemoryStorage||!0===a.PersistentStorage.get(\"previous_websocket_failure\")},p.prototype.markConnectionHealthy=function(){a.PersistentStorage.remove(\"previous_websocket_failure\")},p.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length==this.totalFrames){var t=this.frames.join(\"\");this.frames=null;var n=l.jsonEval(t);this.onMessage(n)}},p.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},p.prototype.extractFrameCount_=function(e){if(n.assert(null===this.frames,\"We already have a frame buffer\"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},p.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter(\"bytes_received\",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},p.prototype.send=function(e){this.resetKeepAlive();var t=l.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter(\"bytes_sent\",t.length);var n=o.splitStringBySize(t,h);n.length>1&&this.sendString_(String(n.length));for(var i=0;i<n.length;i++)this.sendString_(n[i])},p.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},p.prototype.onClosed_=function(){this.isClosed_||(this.log_(\"WebSocket is closing itself\"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},p.prototype.close=function(){this.isClosed_||(this.log_(\"WebSocket is being closed\"),this.shutdown_())},p.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_(\"0\"),e.resetKeepAlive()},Math.floor(u))},p.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_(\"Exception thrown from WebSocket.send():\",e.message||e.data,\"Closing connection.\"),setTimeout(this.onClosed_.bind(this),0)}},p.responsesRequiredToBeHealthy=2,p.healthyTimeout=3e4,p}();exports.WebSocketConnection=d;"},"hash":"c67dd4e7870b3d14678290ccc799bfce","cacheData":{"env":{}}}