{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/messaging/package.json","includedInParent":true,"mtime":1519337717000},{"name":"tslib","loc":{"line":17,"column":25}},{"name":"./db-interface","loc":{"line":18,"column":24}},{"name":"./errors","loc":{"line":19,"column":19}},{"name":"../helpers/array-buffer-to-base64","loc":{"line":20,"column":32}},{"name":"./clean-v1-undefined","loc":{"line":21,"column":24}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"tslib\"),t=f(e),r=require(\"./db-interface\"),o=u(r),n=require(\"./errors\"),c=u(n),a=require(\"../helpers/array-buffer-to-base64\"),s=u(a),i=require(\"./clean-v1-undefined\");function u(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var d=\"fcm_token_object_Store\",p=\"fcm_token_details_db\",_=2;function l(){}l.prototype.fcmToken,l.prototype.swScope,l.prototype.vapidKey,l.prototype.subscription,l.prototype.fcmSenderId,l.prototype.fcmPushSet;var h=function(e){function r(){return e.call(this,p,_)||this}return t.__extends(r,e),r.prototype.onDBUpgrade=function(e,t){if(t.oldVersion<1){var r=e.createObjectStore(d,{keyPath:\"swScope\"});r.createIndex(\"fcmSenderId\",\"fcmSenderId\",{unique:!1}),r.createIndex(\"fcmToken\",\"fcmToken\",{unique:!0})}t.oldVersion<2&&(0,i.cleanV1)()},r.prototype.validateInputs_=function(e){return t.__awaiter(this,void 0,void 0,function(){return t.__generator(this,function(t){return!e.fcmToken||\"string\"==typeof e.fcmToken&&0!==e.fcmToken.length?!e.swScope||\"string\"==typeof e.swScope&&0!==e.swScope.length?!e.vapidKey||e.vapidKey instanceof Uint8Array&&65===e.vapidKey.length?!e.subscription||e.subscription instanceof PushSubscription?!e.fcmSenderId||\"string\"==typeof e.fcmSenderId&&0!==e.fcmSenderId.length?!e.fcmPushSet||\"string\"==typeof e.fcmPushSet&&0!==e.fcmPushSet.length?[2]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_PUSH_SET))]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SENDER_ID))]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SUBSCRIPTION))]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_VAPID_KEY))]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SCOPE))]:[2,Promise.reject(this.errorFactory_.create(c.default.codes.BAD_TOKEN))]})})},r.prototype.getTokenDetailsFromToken=function(e){var t=this;return e?this.validateInputs_({fcmToken:e}).then(function(){return t.openDatabase()}).then(function(t){return new Promise(function(r,o){var n=t.transaction([d]).objectStore(d).index(\"fcmToken\").get(e);n.onerror=function(e){o(e.target.error)},n.onsuccess=function(e){var t=e.target.result?e.target.result:null;r(t)}})}):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_TOKEN))},r.prototype.getTokenDetailsFromSWScope=function(e){var t=this;return e?this.validateInputs_({swScope:e}).then(function(){return t.openDatabase()}).then(function(t){return new Promise(function(r,o){var n=t.transaction([d]).objectStore(d).get(e);n.onerror=function(e){o(e.target.error)},n.onsuccess=function(e){var t=e.target.result?e.target.result:null;r(t)}})}):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SCOPE))},r.prototype.saveTokenDetails=function(e){var t=this,r=e.swScope,o=e.vapidKey,n=e.subscription,a=e.fcmSenderId,i=e.fcmToken,u=e.fcmPushSet;return r?o?n?a?i?u?this.validateInputs_({swScope:r,vapidKey:o,subscription:n,fcmSenderId:a,fcmToken:i,fcmPushSet:u}).then(function(){return t.openDatabase()}).then(function(e){var c={swScope:r,vapidKey:(0,s.default)(o),endpoint:n.endpoint,auth:(0,s.default)(n.getKey(\"auth\")),p256dh:(0,s.default)(n.getKey(\"p256dh\")),fcmSenderId:a,fcmToken:i,fcmPushSet:u,createTime:Date.now()};return new Promise(function(r,o){var n=e.transaction([d],t.TRANSACTION_READ_WRITE).objectStore(d).put(c);n.onerror=function(e){o(e.target.error)},n.onsuccess=function(e){r()}})}):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_PUSH_SET)):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_TOKEN)):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SENDER_ID)):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SUBSCRIPTION)):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_VAPID_KEY)):Promise.reject(this.errorFactory_.create(c.default.codes.BAD_SCOPE))},r.prototype.deleteToken=function(e){var t=this;return\"string\"!=typeof e||0===e.length?Promise.reject(this.errorFactory_.create(c.default.codes.INVALID_DELETE_TOKEN)):this.getTokenDetailsFromToken(e).then(function(e){if(!e)throw t.errorFactory_.create(c.default.codes.DELETE_TOKEN_NOT_FOUND);return t.openDatabase().then(function(r){return new Promise(function(o,n){var a=r.transaction([d],t.TRANSACTION_READ_WRITE).objectStore(d).delete(e.swScope);a.onerror=function(e){n(e.target.error)},a.onsuccess=function(r){0!==r.target.result?o(e):n(t.errorFactory_.create(c.default.codes.FAILED_TO_DELETE_TOKEN))}})})})},r}(o.default);exports.default=h;"},"hash":"28a4ef17a114aad7f7f5c580d585ab27","cacheData":{"env":{}}}