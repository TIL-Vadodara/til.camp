{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/database/package.json","includedInParent":true,"mtime":1519337717000},{"name":"../core/util/util","loc":{"line":18,"column":21}},{"name":"../core/util/CountedSet","loc":{"line":19,"column":27}},{"name":"../core/stats/StatsManager","loc":{"line":20,"column":29}},{"name":"./polling/PacketReceiver","loc":{"line":21,"column":31}},{"name":"./Constants","loc":{"line":22,"column":26}},{"name":"@firebase/util","loc":{"line":24,"column":21}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"../core/util/util\"),t=require(\"../core/util/CountedSet\"),o=require(\"../core/stats/StatsManager\"),n=require(\"./polling/PacketReceiver\"),i=require(\"./Constants\"),s=require(\"@firebase/util\"),r=require(\"@firebase/util\");exports.FIREBASE_LONGPOLL_START_PARAM=\"start\",exports.FIREBASE_LONGPOLL_CLOSE_COMMAND=\"close\",exports.FIREBASE_LONGPOLL_COMMAND_CB_NAME=\"pLPCommand\",exports.FIREBASE_LONGPOLL_DATA_CB_NAME=\"pRTLPCB\",exports.FIREBASE_LONGPOLL_ID_PARAM=\"id\",exports.FIREBASE_LONGPOLL_PW_PARAM=\"pw\",exports.FIREBASE_LONGPOLL_SERIAL_PARAM=\"ser\",exports.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM=\"cb\",exports.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM=\"seg\",exports.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET=\"ts\",exports.FIREBASE_LONGPOLL_DATA_PARAM=\"d\",exports.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM=\"disconn\",exports.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM=\"dframe\";var c=1870,a=30,l=c-a,d=25e3,_=3e4,u=function(){function t(t,n,s,r){this.connId=t,this.repoInfo=n,this.transportSessionId=s,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=e.logWrapper(t),this.stats_=o.StatsManager.getCollection(n),this.urlFn=function(e){return n.connectionURL(i.LONG_POLLING,e)}}return t.prototype.open=function(t,o){var s=this;this.curSegmentNum=0,this.onDisconnect_=o,this.myPacketOrderer=new n.PacketReceiver(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){s.log_(\"Timed out trying to connect.\"),s.onClosed_(),s.connectTimeoutTimer_=null},Math.floor(_)),e.executeWhenDOMReady(function(){if(!s.isClosed_){s.scriptTagHolder=new h(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=e[0],n=e[1],i=e[2];e[3],e[4];if(s.incrementIncomingBytes_(e),s.scriptTagHolder)if(s.connectTimeoutTimer_&&(clearTimeout(s.connectTimeoutTimer_),s.connectTimeoutTimer_=null),s.everConnected_=!0,o==exports.FIREBASE_LONGPOLL_START_PARAM)s.id=n,s.password=i;else{if(o!==exports.FIREBASE_LONGPOLL_CLOSE_COMMAND)throw new Error(\"Unrecognized command received: \"+o);n?(s.scriptTagHolder.sendNewPolls=!1,s.myPacketOrderer.closeAfter(n,function(){s.onClosed_()})):s.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=e[0],n=e[1];s.incrementIncomingBytes_(e),s.myPacketOrderer.handleResponse(o,n)},function(){s.onClosed_()},s.urlFn);var e={};e[exports.FIREBASE_LONGPOLL_START_PARAM]=\"t\",e[exports.FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(1e8*Math.random()),s.scriptTagHolder.uniqueCallbackIdentifier&&(e[exports.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=s.scriptTagHolder.uniqueCallbackIdentifier),e[i.VERSION_PARAM]=i.PROTOCOL_VERSION,s.transportSessionId&&(e[i.TRANSPORT_SESSION_PARAM]=s.transportSessionId),s.lastSessionId&&(e[i.LAST_SESSION_PARAM]=s.lastSessionId),!r.isNodeSdk()&&\"undefined\"!=typeof location&&location.href&&-1!==location.href.indexOf(i.FORGE_DOMAIN)&&(e[i.REFERER_PARAM]=i.FORGE_REF);var t=s.urlFn(e);s.log_(\"Connecting via long-poll to \"+t),s.scriptTagHolder.addTag(t,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&\"undefined\"!=typeof document&&null!=document.createElement&&!e.isChromeExtensionContentScript()&&!e.isWindowsStoreApp()&&!r.isNodeSdk()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_(\"Longpoll is closing itself\"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_(\"Longpoll is being closed.\"),this.shutdown_())},t.prototype.send=function(t){var o=s.stringify(t);this.bytesSent+=o.length,this.stats_.incrementCounter(\"bytes_sent\",o.length);for(var n=s.base64Encode(o),i=e.splitStringBySize(n,l),r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(e,t){if(!r.isNodeSdk()){this.myDisconnFrame=document.createElement(\"iframe\");var o={};o[exports.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]=\"t\",o[exports.FIREBASE_LONGPOLL_ID_PARAM]=e,o[exports.FIREBASE_LONGPOLL_PW_PARAM]=t,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display=\"none\",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(e){var t=s.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter(\"bytes_received\",t)},t}();exports.BrowserPollConnection=u;var h=function(){function o(n,i,s,c){if(this.onDisconnect=s,this.urlFn=c,this.outstandingRequests=new t.CountedSet,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,r.isNodeSdk())this.commandCB=n,this.onMessageCB=i;else{this.uniqueCallbackIdentifier=e.LUIDGenerator(),window[exports.FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=n,window[exports.FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=i,this.myIFrame=o.createIFrame_();var a=\"\";if(this.myIFrame.src&&\"javascript:\"===this.myIFrame.src.substr(0,\"javascript:\".length))a='<script>document.domain=\"'+document.domain+'\";<\\/script>';var l=\"<html><body>\"+a+\"</body></html>\";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(t){e.log(\"frame writing exception\"),t.stack&&e.log(t.stack),e.log(t)}}}return o.createIFrame_=function(){var t=document.createElement(\"iframe\");if(t.style.display=\"none\",!document.body)throw\"Document body has not initialized. Wait to initialize Firebase until after the document is ready.\";document.body.appendChild(t);try{t.contentWindow.document||e.log(\"No IE domain setting required\")}catch(e){var o=document.domain;t.src=\"javascript:void((function(){document.open();document.domain='\"+o+\"';document.close();})())\"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},o.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML=\"\",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),r.isNodeSdk()&&this.myID){var t={};t[exports.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]=\"t\",t[exports.FIREBASE_LONGPOLL_ID_PARAM]=this.myID,t[exports.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;var n=this.urlFn(t);o.nodeRestRequest(n)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},o.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},o.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[exports.FIREBASE_LONGPOLL_ID_PARAM]=this.myID,e[exports.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,e[exports.FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;for(var t=this.urlFn(e),o=\"\",n=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+a+o.length<=c))break;var i=this.pendingSegs.shift();o=o+\"&\"+exports.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+n+\"=\"+i.seg+\"&\"+exports.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+n+\"=\"+i.ts+\"&\"+exports.FIREBASE_LONGPOLL_DATA_PARAM+n+\"=\"+i.d,n++}return t+=o,this.addLongPollTag_(t,this.currentSerial),!0}return!1},o.prototype.enqueueSegment=function(e,t,o){this.pendingSegs.push({seg:e,ts:t,d:o}),this.alive&&this.newRequest_()},o.prototype.addLongPollTag_=function(e,t){var o=this;this.outstandingRequests.add(t,1);var n=function(){o.outstandingRequests.remove(t),o.newRequest_()},i=setTimeout(n,Math.floor(d));this.addTag(e,function(){clearTimeout(i),n()})},o.prototype.addTag=function(t,o){var n=this;r.isNodeSdk()?this.doNodeLongPoll(t,o):setTimeout(function(){try{if(!n.sendNewPolls)return;var i=n.myIFrame.doc.createElement(\"script\");i.type=\"text/javascript\",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){var e=i.readyState;e&&\"loaded\"!==e&&\"complete\"!==e||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),o())},i.onerror=function(){e.log(\"Long-poll script failed to load: \"+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(i)}catch(e){}},Math.floor(1))},o}();exports.FirebaseIFrameScriptHolder=h;"},"hash":"03880a8a150df0bbafb0e2bde30e00ff","cacheData":{"env":{}}}