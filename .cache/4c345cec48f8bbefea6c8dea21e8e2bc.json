{"dependencies":[{"name":"/Volumes/Work/forks/til.camp/package.json","includedInParent":true,"mtime":1526468255000},{"name":"/Volumes/Work/forks/til.camp/.browserslistrc","includedInParent":true,"mtime":1524300285000},{"name":"/Volumes/Work/forks/til.camp/node_modules/@firebase/database/package.json","includedInParent":true,"mtime":1519337717000},{"name":"./filter/IndexedFilter","loc":{"line":18,"column":30}},{"name":"./ViewProcessor","loc":{"line":19,"column":30}},{"name":"../snap/ChildrenNode","loc":{"line":20,"column":29}},{"name":"./CacheNode","loc":{"line":21,"column":26}},{"name":"./ViewCache","loc":{"line":22,"column":26}},{"name":"./EventGenerator","loc":{"line":23,"column":31}},{"name":"@firebase/util","loc":{"line":24,"column":21}},{"name":"../operation/Operation","loc":{"line":25,"column":26}},{"name":"./Change","loc":{"line":26,"column":23}},{"name":"../snap/indexes/PriorityIndex","loc":{"line":27,"column":30}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"./filter/IndexedFilter\"),t=require(\"./ViewProcessor\"),r=require(\"../snap/ChildrenNode\"),i=require(\"./CacheNode\"),n=require(\"./ViewCache\"),a=require(\"./EventGenerator\"),s=require(\"@firebase/util\"),o=require(\"../operation/Operation\"),h=require(\"./Change\"),l=require(\"../snap/indexes/PriorityIndex\"),u=function(){function u(s,o){this.query_=s,this.eventRegistrations_=[];var h=this.query_.getQueryParams(),l=new e.IndexedFilter(h.getIndex()),u=h.getNodeFilter();this.processor_=new t.ViewProcessor(u);var c=o.getServerCache(),v=o.getEventCache(),g=l.updateFullNode(r.ChildrenNode.EMPTY_NODE,c.getNode(),null),d=u.updateFullNode(r.ChildrenNode.EMPTY_NODE,v.getNode(),null),p=new i.CacheNode(g,c.isFullyInitialized(),l.filtersNodes()),C=new i.CacheNode(d,v.isFullyInitialized(),u.filtersNodes());this.viewCache_=new n.ViewCache(C,p),this.eventGenerator_=new a.EventGenerator(this.query_)}return u.prototype.getQuery=function(){return this.query_},u.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},u.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},u.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},u.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},u.prototype.removeEventRegistration=function(e,t){var r=[];if(t){s.assert(null==e,\"A cancel should cancel all event registrations.\");var i=this.query_.path;this.eventRegistrations_.forEach(function(e){t=t;var n=e.createCancelEvent(t,i);n&&r.push(n)})}if(e){for(var n=[],a=0;a<this.eventRegistrations_.length;++a){var o=this.eventRegistrations_[a];if(o.matches(e)){if(e.hasAnyCallback()){n=n.concat(this.eventRegistrations_.slice(a+1));break}}else n.push(o)}this.eventRegistrations_=n}else this.eventRegistrations_=[];return r},u.prototype.applyOperation=function(e,t,r){e.type===o.OperationType.MERGE&&null!==e.source.queryId&&(s.assert(this.viewCache_.getCompleteServerSnap(),\"We should always have a full cache before handling merges\"),s.assert(this.viewCache_.getCompleteEventSnap(),\"Missing event cache, even though we have a server cache\"));var i=this.viewCache_,n=this.processor_.applyOperation(i,e,t,r);return this.processor_.assertIndexed(n.viewCache),s.assert(n.viewCache.getServerCache().isFullyInitialized()||!i.getServerCache().isFullyInitialized(),\"Once a server snap is complete, it should never go back\"),this.viewCache_=n.viewCache,this.generateEventsForChanges_(n.changes,n.viewCache.getEventCache().getNode(),null)},u.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),r=[];t.getNode().isLeafNode()||t.getNode().forEachChild(l.PRIORITY_INDEX,function(e,t){r.push(h.Change.childAddedChange(e,t))});return t.isFullyInitialized()&&r.push(h.Change.valueChange(t.getNode())),this.generateEventsForChanges_(r,t.getNode(),e)},u.prototype.generateEventsForChanges_=function(e,t,r){var i=r?[r]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,i)},u}();exports.View=u;"},"hash":"ae285282f5c2e8d8c0fee99f81f9dd68","cacheData":{"env":{}}}